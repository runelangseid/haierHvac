<?php 

$raw = array( 3050,3000,3050,4400,550,1650,600,500,600,1600,600,500,600,550,550,1650,550,1650,550,550,550,1650,550,550,550,550,550,1650,550,550,550,550,600,1600,600,500,600,1600,600,1600,600,550,550,550,550,550,550,550,600,1600,550,550,600,500,600,550,550,550,550,550,550,550,600,500,600,500,600,500,600,500,600,1600,600,550,550,550,550,550,600,1600,550,550,550,550,600,550,550,1600,600,1600,600,550,550,550,550,550,600,500,600,500,600,1600,600,500,600,500,600,550,550,550,550,550,550,550,550,550,600,1600,600,500,600,550,450,650,550,550,600,500,600,500,600,500,600,500,600,550,550,550,550,550,550,550,600,500,600,500,600,550,550,550,550,550,550,550,550,550,550,550,600,500,600,500,600,550,550,550,600,500,600,550,550,500,600,500,600,550,550,550,550,550,500,600,600,500,600,500,600,550,550,550,550,550,550,550,550,550,550,550,600,500,600,550,550,550,500,600,600,500,600,500,600,550,550,1600,600,550,550,550,550,1650,550,1650,550,1650,550,1600,600,550,500 );
// replaced 500 & 600 with 550,
// replaced 1550 & 1650 with 1600,
// replaced 3050 & ? with 3000,
$raw = array( 3000,3000,3000,4400,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,550,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,450,650,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,1600,550,1600,550,550,550 );

// replaced 650 & 450 with 550
$raw = array( 3000,3000,3000,4400,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,550,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,1600,550,1600,550,550,550 );

// removed pre-amble
// v1 - 59byte
$raw = array( 3000,3000,3000,4400,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,550,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,1600,550,1600,550,550,550 );
// code 2 - light
$raw = array( 3000,3000,3000,4400,550,1600,550,550,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,550,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,1600,550,550,550,1600,550,1600,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,1600,550);
// code 2 - light - removed preamble - first 21 elements
$raw = array( 550,550,1600,550,1600,550,550,550,550,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,1600,550,550,550,1600,550,1600,550,1600,550,550,550,550,550,1600,550,1600,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,1600,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,1600,550,550,550,1600,550,1600,550,550,550,1600,550);

$rawEncoded = array();

$u = array_unique( $raw );
$k = array( 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q' );
$keys = array();

// Assign keys to values
$ii = 0;
foreach ( $u as $i => $e )
{
    //$keys[$k[$v]] = $e;
    $keys[$e] = $k[$ii];
    $ii++;
}

// Replace values with keys
foreach ( $raw as $i => $r )
{
    $rawEncoded[] = $keys[$r];
}

var_dump( 'u', $u );
var_dump( 'keys', $keys );
//var_dump( 'raw', $raw );
var_dump( 'raw count', count( $raw ) );
//var_dump( 'rawEncoded', $rawEncoded );

echo 'uniqe ' . count( $u ) . "\n";

$new = array();

// Run-length encoding
$last = 0;
$buffer = array();
$rawRunEncoded = array();
foreach ( $rawEncoded as $i => $r )
{
    // if new value - append buffer to data
    if ( $last != $r )
    //if ( $last != $r OR count( $buffer ) == 9 )
    {
        //$rawRunEncoded = array_merge( $rawRunEncoded, $buffer );
        if ( count( $buffer ) > 1 )
        {
            $rawRunEncoded[] = count( $buffer );
        }
        $rawRunEncoded[] = $last;
        $buffer = array();
    }
    
    $buffer[] = $r;
    $last = $r;
}
//$rawRunEncoded = array_merge( $rawRunEncoded, $buffer );

//var_dump( 'rawRunEncoded', $rawRunEncoded );
var_dump( 'rawRunEncoded count', count( $rawRunEncoded ) );
foreach( $rawRunEncoded as $r )
{
    echo $r;
}
echo "\n";
