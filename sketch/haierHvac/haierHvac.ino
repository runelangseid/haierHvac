
/** Arduino HVAC wireless IR transmitter
 * Connect wireless 433.92mhz to D2 - Interrupt 1 on UNO
 *
 * Notes
 * - tdtool sends a raw command 10 times
 *
 * First three Z's are ignored (used as preamble)
 * Next, use Z as logic 1, \20x as logic 0
 * Z is 900, \20x is > 100
 *
 * Received value is 128 - echo -e "SZZZZ\x20\x20\x20\x20\x20\x20\x20+" | tdtool --raw - 2>&1
 *
 * Bugs & todo
 * - first transmission after successfull retrieval submit value again
 * - preamble does not work correctly / other things gets through
 * - better handling of repeated codes within 1(?) seconds
 *
 */

const int MAX_CHANGES = 78;

volatile unsigned int duration;
volatile unsigned int highDuration;
volatile unsigned int start;

unsigned int timings[MAX_CHANGES];

volatile int nReceivedValue;
volatile int nReceivedBitlength;
volatile int nReceivedDelay;
volatile int nReceivedProtocol = 0;

// IR
int IRledPin =  13;    // LED connected to digital pin 13

void setup()
{
  Serial.begin(9600);
  Serial.println("START");

  // Setup interrupt routine
  attachInterrupt(0, handleInterrupt, CHANGE);

  // IR - Initialize the digital pin as an output:
  pinMode(IRledPin, OUTPUT);

}

void loop()
{
  if (nReceivedProtocol == 1)
  {
    Serial.print("nReceivedValue:");
    Serial.println(nReceivedValue);

    if ( nReceivedValue == 10 )
    {
      Serial.println("Sending 10");
      Send10();
    }
    else if ( nReceivedValue == 17 )
    {
      Serial.println("Sending 17");
      Send17();
    }
    /*else if ( nReceivedValue == 18 )
    {
      Serial.println("Sending 18");
      Send18();
    }*/
    else if ( nReceivedValue == 19 )
    {
      Serial.println("Sending 19");
      Send19();
    }
    else if ( nReceivedValue == 20 )
    {
      Serial.println("Sending 20");
      Send20();
    }
    else if ( nReceivedValue == 21 )
    {
      Serial.println("Sending 21");
      Send21();
    }
    /*else if ( nReceivedValue == 22 )
    {
      Serial.println("Sending 22");
      Send22();
    }*/
    else if ( nReceivedValue == 23 )
    {
      Serial.println("Sending 23");
      Send23();
    }
    /*else if ( nReceivedValue == 24 )
    {
      Serial.println("Sending 24");
      Send24();
    }*/
    else if ( nReceivedValue == 25 )
    {
      Serial.println("Sending 25");
      Send25();
    }
    else if ( nReceivedValue == 30 )
    {
      Serial.println("Sending on");
      SendOn();
    }
    else if ( nReceivedValue == 31 )
    {
      Serial.println("Sending Heat");
      SendHeat();
    }
    else if ( nReceivedValue == 35 )
    {
      Serial.println("Sending Soft On");
      SendSoftOn();
    }
    else if ( nReceivedValue == 36 )
    {
      Serial.println("Sending Soft off");
      SendSoftOff();
    }

    nReceivedProtocol = 0;
    nReceivedBitlength = 0;
    nReceivedValue = 0;

  }
}

/** Expected preamble is 3 pules of =900 (Z)
 * Send command: echo -e "SZZZABCD+" | tdtool --raw - 2>&1
 *
 */
bool checkPreamble()
{
  int l = 800;
  int h = 1000;

  if (timings[1] > l && timings[1] < h )
  {
    if (timings[2] > l && timings[2] < h )
    {
      if (timings[3] > l && timings[3] < h )
      {
        return true;
      }
    }
  }

  return false;
}

/** Check if code has been sent
 *
 */
bool receivedCode(unsigned int changedCount)
{
  if ( checkPreamble() )
  {

    for (int i = 4; i<changedCount; i++)
    {
      if (timings[i] > 100)
      {
        // Got a 1 bit
        nReceivedValue = nReceivedValue << 1;
        if (timings[i] > 800)
        {
          nReceivedValue++;
        }
      }

    }

    // 12 is 8 bit
    if (changedCount >= 12)
    {
      //detachInterrupt(0);
      nReceivedBitlength = changedCount;
      nReceivedProtocol = 1;
    }
    return true;

  }

}

/* Interrupt handling routine */
void handleInterrupt()
{
  static unsigned int duration;
  static unsigned int changeCount;
  static unsigned long lastTime;
  static unsigned int repeatCount;
  long time = micros();
  duration = time - lastTime;

  //if (duration > 5000 && duration > RCSwitch::timings[0] - 200 && duration < RCSwitch::timings[0] + 200) {
  // - tellstick sends 0 for > 5000 before each packet
  if (duration > 5000)
  {
    //repeatCount++;
    //changeCount--;

    if ( changeCount >= 3 )
    {
      if ( receivedCode(changeCount) == false )
      {
        // failed
      }
    }

    changeCount = 0;
  }
  
  // highDuration is debug
  if ( duration > highDuration )
  {
    highDuration = duration;
  }

 
  // 12 is 8 bit
  if (changeCount >= 12)
  {
    changeCount = 0;
    repeatCount = 0;
  }

  timings[changeCount++] = duration;
  lastTime = time;
}


// IR stuff
// This procedure sends a 38KHz pulse to the IRledPin 
// for a certain # of microseconds. We'll use this whenever we need to send codes
void pulseIR(long microsecs) {
  // we'll count down from the number of microseconds we are told to wait

  cli();  // this turns off any background interrupts

  while (microsecs > 0) {
    // 38 kHz is about 13 microseconds high and 13 microseconds low
   digitalWrite(IRledPin, HIGH);  // this takes about 3 microseconds to happen
   delayMicroseconds(10);         // hang out for 10 microseconds
   digitalWrite(IRledPin, LOW);   // this also takes about 3 microseconds
   delayMicroseconds(10);         // hang out for 10 microseconds

   // so 26 microseconds altogether
   microsecs -= 26;
  }

  sei();  // this turns them back on
}


/*
 * IR code section
 *
 */
// Send 10
void Send10() {
  int codes[400] = {
    3020,3020,3000,4360,560,1600,580,520,600,1580,600,500,580,520,580,1600,580,1580,600,500,580,500,580,520,540,560,520,1660,580,1580,600,520,500,1660,520,580,580,500,560,540,540,560,520,580,580,500,580,520,520,1660,540,540,540,560,520,580,560,520,580,520,540,540,540,580,560,520,560,540,520,560,520,1660,520,1660,540,560,520,580,560,1620,560,520,560,520,540,560,520,1660,540,1640,540,560,520,580,560,520,580,500,580,520,540,560,580,520,580,500,540,560,520,580,560,540,560,520,580,500,540,1640,540,580,520,560,560,540,520,560,540,580,500,580,500,580,580,520,520,560,540,580,560,520,580,520,520,580,500,600,500,580,580,500,540,560,520,580,560,520,580,520,540,560,520,560,520,580,580,520,520,560,540,580,540,540,580,500,540,560,520,560,540,560,560,1620,560,540,520,560,540,580,500,580,560,540,520,560,600,480,580,540,560,520,580,520,560,1620,520,1660,520,1660,520,1640,600,500,540,1640,500,580,540,1640,540,560,520,580,560,1620,580,520,500,580,560,
    99999
  };
  sendIR( codes, 400);
}

// Send 17
void Send17() {
  int codes[400] = {
    3020,3020,3020,4320,520,1660,580,540,540,1640,540,540,580,520,580,1600,580,1580,560,540,580,520,560,540,540,540,580,1600,560,1620,560,540,580,1580,540,560,580,500,600,520,560,520,560,540,580,500,580,540,520,1640,560,540,480,600,580,520,580,500,580,540,540,540,580,520,560,520,580,540,560,520,580,1600,560,1620,540,540,580,520,580,520,560,1600,580,1600,540,540,580,1600,580,1600,580,520,580,500,580,540,460,620,520,560,580,520,580,520,560,520,580,520,580,500,580,540,560,520,560,540,580,1600,560,520,580,540,540,540,540,540,580,520,580,500,580,540,560,520,580,520,560,520,580,520,560,540,580,500,580,520,580,520,560,520,580,520,580,500,580,540,540,540,580,520,580,500,580,540,540,540,560,520,580,520,580,520,580,520,580,500,580,500,580,540,560,520,560,540,580,500,580,540,540,540,580,500,580,520,580,500,580,540,540,540,580,520,560,540,560,540,540,540,580,500,580,520,580,520,560,520,600,500,580,520,560,540,540,1640,540,540,580,1580,580,
    99999
  };
  sendIR( codes, 400);
}

// Send 18
void Send18() {
  int codes[400] = {
    3000,3040,2940,4420,540,1640,520,560,540,1640,540,580,520,560,520,1660,520,1640,540,600,500,600,460,580,540,1640,540,600,500,1640,540,600,480,1640,540,620,480,600,460,620,500,600,500,600,480,620,440,640,500,580,520,560,520,600,460,640,560,520,500,620,480,600,460,620,520,580,560,520,500,620,440,1700,480,640,480,1660,500,600,540,1640,540,1640,480,1680,520,620,480,1640,540,1640,540,600,460,600,500,580,540,580,500,620,480,600,460,580,560,580,500,600,500,600,480,560,560,580,500,600,480,1640,540,620,440,600,520,600,520,600,480,600,460,600,480,600,540,580,520,600,460,600,500,580,540,580,500,620,440,600,500,620,520,580,500,600,500,560,520,580,520,600,500,600,460,600,500,620,500,580,520,600,480,560,500,600,540,580,500,620,480,560,520,580,540,580,500,620,460,620,440,600,540,580,520,600,480,600,500,600,500,560,520,620,480,600,460,600,540,580,500,600,480,620,480,600,480,600,520,580,500,620,440,640,500,560,540,1640,540,1620,500,1660,540,
    99999
  };
  sendIR( codes, 400);
}

// Send 19
void Send19() {
  int codes[400] = {
    3000,3020,3000,4340,600,1580,540,580,480,1700,500,580,500,600,520,1640,540,1640,500,600,540,560,520,580,500,1680,500,1660,520,1660,520,580,500,1660,540,600,460,620,480,600,520,580,500,620,440,600,540,560,540,580,500,620,440,640,480,580,540,580,500,600,460,640,540,520,520,580,520,600,480,620,460,1660,500,600,540,1640,540,540,560,1620,540,1640,560,1600,540,600,460,1680,520,1660,540,600,460,620,500,600,500,580,500,620,440,640,480,580,540,600,480,600,460,600,540,540,540,580,500,620,460,1680,520,600,480,580,540,580,500,580,480,600,520,560,520,620,500,600,480,620,440,640,500,580,520,600,480,600,480,580,480,640,520,600,480,600,460,620,520,580,500,620,460,620,440,600,500,640,500,560,520,620,440,600,540,580,520,600,480,600,460,640,440,600,540,580,520,600,460,640,460,580,540,560,520,620,440,640,460,620,520,580,500,620,440,600,520,600,500,600,500,600,460,620,460,640,500,580,520,600,480,560,520,1660,500,600,540,1640,540,1620,540,1620,560,
    99999
  };
  sendIR( codes, 400);
}

// Send 20
void Send20() {
  int codes[400] = {
    3000,3020,2960,4420,520,1640,520,620,500,1640,540,580,520,560,520,1660,520,1640,540,600,480,580,480,1680,500,640,500,580,520,1640,520,620,480,1640,540,580,500,600,460,600,540,580,520,600,480,600,460,600,540,580,500,580,520,600,460,620,500,560,540,560,520,580,480,640,500,580,520,580,500,600,460,1680,520,620,480,1660,480,620,520,1640,540,1640,520,1640,540,620,460,1660,520,1660,520,620,480,600,480,580,540,580,500,600,500,600,460,580,540,600,500,560,520,620,460,620,500,580,520,600,480,1640,540,600,460,600,500,620,500,620,480,600,460,620,460,600,540,560,520,620,440,640,480,600,520,560,520,620,440,600,480,600,540,560,540,600,480,580,500,580,540,580,520,600,460,620,480,580,540,580,500,620,460,620,460,620,520,580,500,600,480,580,520,560,540,580,520,560,520,600,460,600,540,580,500,620,480,600,480,580,500,580,540,600,500,600,460,580,560,580,500,600,480,580,500,620,480,580,540,580,500,1640,540,600,460,600,520,1660,480,1680,540,1620,520,
    99999
  };
  sendIR( codes, 400);
}

 // Send 21
void Send21() {
  int codes[400] = {
    3040,3040,2940,4420,520,1660,520,600,500,1640,540,580,520,600,480,1660,520,1640,540,580,500,620,460,1680,480,600,540,1640,520,1660,520,600,520,1640,480,640,500,560,520,580,500,620,480,580,540,580,500,580,480,600,500,600,520,600,500,580,480,600,500,600,520,580,520,560,500,620,460,600,540,580,520,1640,520,1660,520,1640,540,560,540,1640,540,580,500,1640,520,580,520,1640,540,1640,540,600,500,600,480,580,480,600,500,600,540,560,520,600,460,600,540,560,520,580,520,600,460,600,480,620,520,1640,540,580,500,580,520,560,520,580,540,580,500,580,500,620,440,640,500,560,540,600,480,600,480,580,540,560,540,580,500,600,460,600,540,560,520,620,480,600,460,600,540,580,500,580,500,620,440,600,520,580,540,600,480,600,460,600,540,580,500,580,520,560,500,600,500,620,500,580,520,600,460,620,500,560,540,580,500,620,460,620,480,580,540,560,520,600,460,640,480,580,520,580,520,600,480,600,480,1680,480,600,540,1640,520,580,520,1640,560,560,520,1640,500,
    99999
  };
  sendIR( codes, 400);
}

// Send 22
/*void Send22() {
  int codes[400] = {
    3000,3060,3000,4380,520,1660,540,600,460,1680,520,600,480,600,520,1640,540,1640,540,540,540,580,520,1620,560,1620,560,560,520,1640,540,600,460,1660,540,620,440,600,520,560,560,580,500,600,460,600,540,580,500,580,520,600,460,580,520,580,540,580,500,620,440,600,540,580,520,580,500,600,480,580,500,1680,560,520,540,1640,540,1640,520,600,520,580,500,1640,560,560,500,1640,520,1660,520,580,540,580,500,600,540,520,560,560,520,560,520,600,480,620,460,580,540,580,520,600,460,580,520,620,500,1640,520,560,540,580,520,600,460,600,520,560,540,580,500,620,440,600,520,580,540,580,500,600,460,640,480,580,520,580,520,600,480,620,460,620,500,600,500,600,460,620,480,580,540,580,500,620,480,600,440,640,520,580,500,620,460,580,500,580,540,580,520,600,480,600,460,640,500,580,500,620,480,600,480,580,540,580,500,620,480,600,460,580,540,580,520,600,480,620,440,600,540,580,500,600,500,600,460,1680,500,600,520,560,540,1640,540,580,520,580,500,1640,480,
    99999
  };
  sendIR( codes, 400);
}*/

 // Send 23
void Send23() {
  int codes[400] = {
    3000,3020,2960,4420,600,1580,500,580,540,1640,540,580,520,600,480,1660,520,1640,540,600,480,620,460,1660,580,1600,580,1600,540,1640,520,620,520,1600,540,600,480,600,520,580,500,620,440,600,520,580,540,580,500,580,500,620,440,600,540,580,520,600,480,560,520,580,540,580,520,560,520,600,460,620,520,1620,520,580,540,1640,540,1640,540,580,520,560,520,1620,520,580,540,1640,540,1640,540,580,520,600,480,560,500,620,460,600,540,600,480,620,440,600,540,600,500,600,480,620,440,640,460,620,520,1620,560,580,500,600,480,580,500,620,500,580,520,580,500,600,460,600,540,580,520,600,480,600,480,580,540,580,500,580,500,620,440,600,540,600,500,600,480,600,460,600,540,560,540,580,500,600,460,600,540,560,520,620,480,600,460,620,520,580,500,580,500,620,460,580,520,580,540,580,500,620,440,600,540,580,500,600,500,600,460,600,500,620,500,580,520,600,460,620,480,620,500,580,500,620,480,560,520,1660,500,580,560,1620,560,1620,520,580,540,580,500,1640,520,
    99999
  };
  sendIR( codes, 400);
}

 // Send 24
/*void Send24() {
  int codes[400] = {
    3000,3020,2960,4420,600,1580,500,580,540,1640,540,580,520,600,480,1660,520,1640,540,600,480,1660,520,600,460,600,540,580,520,1620,560,600,480,1640,540,600,480,620,440,600,540,580,520,600,480,600,460,640,500,580,500,620,480,600,460,620,520,580,500,620,460,620,440,600,540,580,520,540,540,600,460,1680,500,600,520,1660,480,1700,480,640,500,560,600,1560,540,600,480,1660,480,1700,480,600,540,560,540,600,480,580,520,600,480,600,520,580,500,600,460,640,460,580,540,580,520,580,500,620,440,1680,500,600,540,560,520,620,480,560,500,600,540,580,500,580,500,620,440,600,540,580,520,600,480,600,460,600,540,580,520,560,520,600,460,600,500,580,540,620,480,600,460,620,520,580,500,560,520,580,480,600,520,600,520,580,500,600,460,640,500,540,520,580,540,600,480,600,480,580,540,600,500,560,500,620,480,580,500,620,500,620,480,600,460,580,560,560,520,600,480,580,520,560,520,580,540,600,480,1660,520,1640,540,600,460,1680,520,620,440,600,500,1660,540,
    99999
  };
  sendIR( codes, 400);
}*/

 // Send 25
void Send25() {
  int codes[400] = {
    3000,3080,3040,4300,540,1640,540,580,480,1700,520,560,500,600,520,1660,520,1640,500,600,540,1640,540,560,520,580,520,1640,520,1660,520,580,500,1660,540,580,480,600,520,580,520,560,540,560,480,620,520,580,520,560,520,580,480,600,520,580,540,580,500,580,480,600,520,580,540,540,540,580,500,580,500,1680,480,600,540,1640,540,1640,520,580,540,1640,480,1680,520,580,480,1700,500,1680,520,560,500,600,540,540,540,560,520,580,480,600,580,520,540,580,500,580,480,600,540,560,520,560,540,560,500,1680,520,580,500,580,540,560,520,580,480,600,520,580,580,500,540,580,520,560,500,600,520,560,540,580,500,580,500,580,560,540,540,560,520,580,480,600,540,560,520,580,580,500,480,620,480,600,540,560,520,580,480,600,540,560,540,560,520,580,480,600,500,600,520,600,500,580,480,600,500,600,520,580,520,560,500,600,480,600,600,500,520,580,480,600,520,580,600,500,520,580,480,600,480,620,520,560,540,1640,540,1640,540,1640,540,1640,540,560,520,1640,520,1640,540,
    99999
  };
  sendIR( codes, 400);
}

// Send On
void SendOn() {
  int codes[400] = {
    3000,3040,2940,4420,600,1580,520,600,500,1640,560,560,520,600,480,1660,520,1640,540,620,460,1660,540,600,440,640,520,1620,540,1640,520,600,520,1640,540,540,540,580,520,600,460,620,500,580,520,600,480,620,500,540,560,520,560,580,500,600,520,580,480,560,540,600,500,600,520,520,580,520,540,580,500,1640,540,620,540,1600,520,1640,540,600,520,1600,540,1640,580,500,540,1640,540,1640,540,580,520,600,560,520,480,620,520,560,520,580,500,600,520,540,540,540,540,620,480,600,460,580,500,600,540,1640,540,580,500,620,460,580,520,580,540,580,500,580,500,620,520,520,540,580,520,600,480,600,480,620,500,580,500,580,520,600,520,540,540,540,540,600,500,600,460,620,520,560,520,580,500,620,500,540,540,580,520,600,480,600,460,600,540,580,500,580,520,600,520,520,520,620,500,580,500,620,440,600,540,580,520,580,500,600,460,600,520,600,520,560,520,600,460,600,520,1660,500,620,480,1640,540,1640,540,600,460,600,520,560,540,580,520,600,440,640,460,640,460,
    99999
  };
  sendIR( codes, 400);
}

// Send Heat
void SendHeat() {
  int codes[400] = {
    3000,3040,2940,4420,540,1640,520,580,540,1640,540,580,500,620,460,1660,520,1640,560,600,480,1660,520,600,460,640,500,1640,540,1640,500,580,540,1640,500,580,560,560,520,600,460,640,500,540,540,620,480,600,460,620,460,640,500,580,500,620,440,640,480,580,540,580,500,600,460,640,440,600,540,600,500,1640,540,600,480,1660,520,1640,540,1640,540,580,500,620,440,600,540,1640,520,1660,500,600,540,580,500,580,500,620,480,600,500,560,540,600,480,620,440,600,540,580,520,600,480,600,480,620,480,1660,500,620,500,600,500,600,460,600,500,580,540,580,500,620,480,600,460,600,540,580,500,620,440,600,520,580,520,600,500,600,480,600,460,600,540,580,520,600,480,600,480,580,540,580,500,620,480,600,460,620,520,560,520,600,480,620,440,600,540,580,520,580,500,600,460,600,540,560,520,580,520,600,460,620,520,580,500,580,520,600,460,580,520,580,540,600,480,620,440,1700,480,1660,560,600,460,1680,500,620,480,580,540,580,500,620,440,600,520,1660,520,600,460,
    99999
  };
  sendIR( codes, 400);
}

 // Send Soft On
void SendSoftOn() {
  int codes[400] = {
    //3000,3060,3000,4380,520,1660,520,620,520,1620,520,600,540,520,540,1620,560,1620,560,580,500,580,500,1660,520,620,480,1640,540,1640,540,600,520,1600,540,620,500,580,480,580,540,600,480,600,460,600,540,540,540,580,520,600,520,560,480,620,500,580,500,620,520,520,540,580,520,580,500,600,480,620,480,1660,560,1620,560,1620,560,560,480,1660,580,1600,520,1640,540,580,520,1620,540,1640,540,600,500,600,520,520,560,580,480,580,540,1620,560,600,480,600,460,600,540,580,500,620,460,620,480,600,500,1640,600,520,520,580,500,620,520,520,540,560,540,580,500,600,480,580,500,580,540,580,520,600,460,580,520,580,540,580,500,620,480,600,480,620,500,580,500,600,460,640,480,560,560,580,500,600,480,620,440,640,500,580,520,600,480,600,480,580,540,580,500,620,480,600,460,620,520,540,540,600,500,600,440,600,540,600,500,580,500,620,440,600,540,560,540,600,480,1640,540,600,520,580,440,600,540,1640,540,1640,520,580,540,1620,560,1620,560,1620,540,1640,520,1640,540,
    3060,3060,3000,4380,520,1640,540,620,520,1620,520,600,480,580,540,1620,560,1620,560,580,500,580,500,1640,540,1640,540,1640,540,1640,540,580,500,1640,520,580,540,620,460,620,460,580,540,580,520,1640,540,1640,540,580,500,600,480,580,500,600,520,600,500,600,460,620,480,620,500,580,520,600,480,600,480,1660,560,1620,560,540,500,620,500,600,480,580,520,600,480,580,540,1620,560,1640,540,540,540,620,480,600,460,580,500,600,540,1640,540,580,500,620,460,620,480,600,520,580,500,580,500,620,440,1700,480,640,480,600,520,600,480,620,440,600,540,580,500,560,540,600,460,580,520,620,500,580,520,600,460,620,500,560,500,600,520,620,460,620,480,580,520,600,500,600,460,640,460,620,480,580,540,560,520,600,480,580,540,580,500,620,440,600,520,580,500,1660,520,620,440,600,540,580,520,600,480,620,440,600,540,560,520,600,500,600,460,600,540,580,500,620,480,1640,540,600,440,640,460,600,540,1640,540,1620,520,1680,500,1680,480,640,500,1640,540,560,500,1660,520,
    99999
  };
  sendIR( codes, 400);
}

 // Send Soft Off
void SendSoftOff() {
  int codes[400] = {
    //3000,3080,2980,4380,540,1640,540,600,520,1620,520,600,480,620,500,1640,540,1640,560,560,520,560,520,1640,540,600,480,1660,520,1640,540,620,500,1620,540,600,520,560,480,580,540,580,500,620,440,600,540,560,540,540,540,600,460,600,500,580,540,580,520,600,460,620,480,620,500,580,520,600,480,560,520,1660,560,1620,560,1620,560,520,520,1660,520,1660,520,1640,540,600,500,1640,540,1640,540,580,500,620,440,600,540,580,480,580,540,600,480,580,500,580,540,580,520,600,460,620,480,580,520,600,500,1640,540,620,480,600,460,600,540,580,500,600,480,620,480,600,480,600,520,580,500,620,440,640,500,560,520,620,480,600,480,620,460,580,540,580,520,600,460,580,520,580,540,600,480,580,520,600,480,580,540,580,500,600,460,600,520,560,540,580,520,580,500,620,440,600,540,580,500,620,480,560,520,580,540,580,500,580,520,600,460,600,540,580,500,600,480,620,460,1680,480,600,540,600,500,560,520,600,460,1680,520,580,520,1660,480,1700,480,1700,480,1680,540,1620,500,
    3060,3060,3000,4340,560,1640,540,620,520,1620,500,620,480,600,500,1640,560,1620,560,540,540,580,500,1640,540,1640,540,1640,540,1640,540,580,520,1620,520,600,520,600,480,620,460,580,540,580,500,1660,540,1640,540,580,500,600,480,580,520,560,540,580,500,620,460,620,480,620,500,580,500,620,480,600,480,1660,500,1680,560,540,500,580,540,620,460,600,500,600,480,580,540,1620,560,1620,560,580,500,620,460,620,440,600,500,640,500,580,500,620,440,600,520,580,540,580,500,600,460,600,480,600,540,1640,540,580,520,600,480,600,460,600,540,580,500,580,520,600,460,620,520,540,540,620,460,620,440,620,520,600,500,580,500,600,460,640,480,580,540,600,480,600,460,600,540,580,500,580,520,600,460,640,460,580,540,580,500,620,440,600,540,560,540,580,500,1640,480,600,540,600,500,600,480,560,520,580,540,580,500,580,520,600,460,640,500,580,500,620,460,580,520,1660,480,600,540,600,500,560,520,620,440,1700,500,1680,500,1660,540,600,440,1700,500,580,520,1640,540,
    99999
  };
  sendIR( codes, 400);
}


void sendIR( int codes[], int size ) {
  int b = 0;
  for (int i=0;i<size;i=i+2)
  {
    if ( codes[i] != 99999 )
    {
      pulseIR(codes[i]);
    }

    if ( codes[i+1] != 99999 )
    {
      delayMicroseconds(codes[i+1]);
    }

  }

}

